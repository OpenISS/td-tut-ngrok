<!DOCTYPE html>
<html>
<head>
	<title>My TD Project</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<style>
	button {
		font-size: 2em;
		user-select: none;
		-webkit-user-select: none;
	}
</style>
<body>
	<button id="mainButton">Press me!</button>
	<div id="eventLog"></div>

	<script>
		var socket = new WebSocket("ws://6fada9ca.ngrok.io")
		var button = document.querySelector("#mainButton")
		var eventLog = document.querySelector("#eventLog")
		var holding = null

		socket.onmessage = function(event) {
			eventLog.innerHTML = event.data + "<br>" + eventLog.innerHTML
		}

		function handleHolding() {
			socket.send("user:mainEvent")
			if (holding !== null) {
				holding = window.requestAnimationFrame(handleHolding)
			}
		}

		function handleUserDown() {
			holding = window.requestAnimationFrame(handleHolding)
		}

		function handleUserUp() {
			console.log("user up")
			window.cancelAnimationFrame(holding)
			holding = null
		}

		button.ontouchstart = handleUserDown
		button.ontouchend = handleUserUp
		button.onmousedown = handleUserDown
		button.onmouseup = handleUserUp
	</script>
</body>
</html>